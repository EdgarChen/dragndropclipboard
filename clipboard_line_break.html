<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clipboard Line Break Test</title>
  <style>
    :root { --bg:#0b1220; --card:#111a2a; --muted:#93a4bf; --text:#e6edf7; --accent:#5ab3ff; --ok:#27c93f; --warn:#ffbd2e; --err:#ff5f56; }
    html, body { background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, PingFang TC, Noto Sans TC, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .wrap { max-width:1100px; margin:24px auto; padding:16px; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:16px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.08); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,0.25); }
    .span-4 { grid-column: span 4; } .span-6 { grid-column: span 6; } .span-8 { grid-column: span 8; } .span-12 { grid-column: span 12; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
    label { font-size:14px; color:var(--muted); }
    select, input[type="text"], textarea, button { color:var(--text); background:#0f1726; border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:10px 12px; font-size:14px; }
    textarea { width:95%; min-height:120px; resize:vertical; }
    button { cursor:pointer; transition: transform .04s ease; }
    button:hover { transform: translateY(-1px); }
    button.primary { background: linear-gradient(180deg, #1774d3, #0f63ba); border:none; }
    button.ghost { background: transparent; }
    kbd { background:#101826; border:1px solid rgba(255,255,255,0.1); border-bottom-color: rgba(0,0,0,0.5); border-radius:6px; padding:1px 6px; font-size:12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Noto Sans Mono", monospace; }
    .pre { white-space: pre-wrap; word-break: break-word; background:#0e1626; border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,0.08); }
    .tag { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,0.14); background:rgba(255,255,255,0.04) }
    .status { font-size:12px; }
    .muted { color:var(--muted); }
    .hidden-input { position:absolute; left:-9999px; }
    @media (max-width: 860px){ .span-6, .span-8, .span-4 { grid-column: span 12; } }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="font-size:28px; margin:0 0 6px 0;">Clipboard Line Break Test</h1>
    <div class="muted" style="margin-bottom:18px;">This is used to test <code class="mono">\r</code>, <code class="mono">\n</code> and <code class="mono">\r\n</code> in <em> Clipboard API</em></div>

    <div class="grid">
      <!-- Write Panel -->
      <div class="card span-6">
        <h2 style="margin-top:0">‚úçÔ∏è Copy to Clipboard</h2>
        <div class="row" style="margin:8px 0 12px;">
          <label>Method</label>
          <label><input type="radio" name="writeMode" value="copy-event" checked> copy event</label>
          <label><input type="radio" name="writeMode" value="async"> async clipboard API</label>
        </div>
        <div class="row" style="margin:0 0 12px;">
          <label>Line breakÔºö</label>
          <select id="newlineSelect">
            <option value="CR">\r (CR)</option>
            <option value="LF">\n (LF)</option>
            <option value="CRLF" selected>\r\n (CRLF)</option>
          </select>
          <span class="muted">The below text will be convert to use the selected line break</span>
        </div>
        <textarea id="writeInput" class="mono" placeholder="Enter text, e.g. \nLine1\nLine2\nLine3"></textarea>
        <div class="row" style="margin-top:10px;">
          <button id="btnWrite" class="primary">Copy to Clipboard</button>
          <button id="btnSample" class="ghost">Example text</button>
          <span id="writeStatus" class="status muted"></span>
        </div>
      </div>

      <!-- Read Panel -->
      <div class="card span-6">
        <h2 style="margin-top:0">üì• Paste from Clipboard</h2>
        <div id="pasteZoneWrap" class="row" style="margin-bottom:10px;">
          <div>
            <div class="muted" style="margin-bottom:6px;">Paste testÔºàpaste eventÔºâ</div>
            <div id="pasteZone" contenteditable="true" class="pre mono" style="min-height:60px; outline:none;">Please click here and press <kbd>Ctrl</kbd>+<kbd>V</kbd>ÔºàmacÔºö<kbd>‚åò</kbd>+<kbd>V</kbd>Ôºâ„ÄÇ
            </div>
          </div>
        </div>
        <div class="row">
          <button id="btnRead" class="primary">Paste from Async Clipboard API</button>
          <span id="readStatus" class="status muted"></span>
        </div>
      </div>

      <!-- Output Panel -->
      <div class="card span-12">
        <h2 style="margin-top:0">üìä Paste Result</h2>
        <div class="row" style="gap:8px; margin-bottom:10px;">
          <span class="tag" id="detectedTag">Line break: ‚Äî</span>
          <span class="tag" id="lenTag">Length: 0</span>
          <span class="tag" id="linesTag">Number of lines: 0</span>
          <span class="tag" id="uaTag" title="User-Agent">UA</span>
        </div>
        <div class="row" style="gap:8px; margin:4px 0 14px;">
          <button id="btnExportTxt" class="ghost">Download raw.txt</button>
          <button id="btnExportEscaped" class="ghost">Download escaped.txt</button>
          <button id="btnExportJson" class="ghost">Download report.json</button>
        </div>
        <div class="grid">
          <div class="span-4">
            <div class="muted" style="margin-bottom:6px;">Original text</div>
            <pre id="outRaw" class="pre mono"></pre>
          </div>
          <div class="span-4">
            <div class="muted" style="margin-bottom:6px;">Escape \r and \n</div>
            <pre id="outEscaped" class="pre mono"></pre>
          </div>
          <div class="span-4">
            <div class="muted" style="margin-bottom:6px;">Code PointsÔºàfirst 200 charÔºâ</div>
            <pre id="outCodes" class="pre mono"></pre>
          </div>
        </div>
      </div>

    </div>

    <input id="hiddenCopyInput" class="hidden-input" aria-hidden="true" />
  </div>

<script>
(function(){
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));

  const writeInput = $('#writeInput');
  const newlineSelect = $('#newlineSelect');
  const writeStatus = $('#writeStatus');
  const readStatus = $('#readStatus');
  const pasteZone = $('#pasteZone');
  const pasteZoneWrap = $('#pasteZoneWrap');

  const outRaw = $('#outRaw');
  const outEscaped = $('#outEscaped');
  const outCodes = $('#outCodes');

  const detectedTag = $('#detectedTag');
  const lenTag = $('#lenTag');
  const linesTag = $('#linesTag');
  const uaTag = $('#uaTag');

  // Exported data
  let lastOutput = {
    text: '',
    escaped: '',
    codePoints: [],
    detected: '‚Äî',
    length: 0,
    lines: 0,
    ua: navigator.userAgent,
    timestamp: ''
  };

  uaTag.textContent = navigator.userAgent;

  $('#btnSample').addEventListener('click', () => {
    writeInput.value = 'Line1\nLine2\nLine3 (there is space at the end) ';
  });

  function normalizeNewlines(text, mode){
    const CR = '\r';
    const LF = '\n';
    const lines = text.split(/\n/g);
    let joiner = LF;
    if(mode === 'CR') joiner = CR;
    else if(mode === 'CRLF') joiner = CR + LF;
    return lines.join(joiner);
  }

  async function writeViaAsyncClipboard(text){
    try{
      await navigator.clipboard.writeText(text);
      setStatus(writeStatus, 'Copied via Async Clipboard API.', 'ok');
    }catch(err){
      setStatus(writeStatus, 'Copy failed:' + err, 'err');
    }
  }

  function writeViaCopyEvent(text){
    const onCopy = (e) => {
      try {
        e.clipboardData.setData('text/plain', text);
        e.preventDefault();
        setStatus(writeStatus, 'Copied via copy event.', 'ok');
      } catch(err){
        setStatus(writeStatus, 'Copy failed:' + err, 'err');
      }
    };
    document.addEventListener('copy', onCopy, { once: true });

    const hidden = $('#hiddenCopyInput');
    hidden.value = 'temporary';
    hidden.select();
    const ok = document.execCommand('copy');
    if(!ok){
      setStatus(writeStatus, 'execCommand(copy) might not workÔºåplease try press Ctrl/Cmd+C manually.', 'warn');
    }
  }

  function setStatus(el, msg, level='info'){
    el.textContent = msg;
    el.style.color = level==='ok' ? 'var(--ok)' : level==='err' ? 'var(--err)' : level==='warn' ? 'var(--warn)' : 'var(--muted)';
  }

  $('#btnWrite').addEventListener('click', async () => {
    const mode = ($('input[name="writeMode"]:checked')||{}).value;
    const nlMode = newlineSelect.value; // CR / LF / CRLF
    const normalized = normalizeNewlines(writeInput.value, nlMode);

    if(mode === 'async'){
      await writeViaAsyncClipboard(normalized);
    } else {
      writeViaCopyEvent(normalized);
    }
  });

  // paste event
  pasteZone.addEventListener('paste', (e) => {
    e.preventDefault();
    const text = e.clipboardData.getData('text/plain');
    setStatus(readStatus, 'Handled paste event.', 'ok');
    renderOutput(text);
  });

  // async clipboard
  $('#btnRead').addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();
      setStatus(readStatus, 'Pasted from Async Clipboard API.', 'ok');
      renderOutput(text);
    } catch(err) {
      setStatus(readStatus, 'Paste failed:' + err, 'err');
    }
  });

  function renderOutput(text){
    outRaw.textContent = text;
    const escaped = escapeVisible(text);
    const codes = codePoints(text).slice(0,200);
    outEscaped.textContent = escaped;
    outCodes.textContent = codes.join(' ');

    const len = text.length;
    const lines = (text.length ? text.split(/\\r\\n|\\r|\\n/).length : 0);
    const detected = detectNewlines(text);

    lenTag.textContent = 'Length: ' + len;
    linesTag.textContent = 'Number of lines: ' + lines;
    detectedTag.textContent = 'Line break: ' + detected;

    lastOutput = {
      text,
      escaped,
      codePoints: codes,
      detected,
      length: len,
      lines,
      ua: navigator.userAgent,
      timestamp: new Date().toISOString()
    };
  }

  function escapeVisible(s){
    return s.replaceAll('\r', '\\r').replaceAll('\n', '\\n');
  }

  function codePoints(s){
    const arr = [];
    for(const ch of s){
      const cp = ch.codePointAt(0).toString(16).toUpperCase();
      arr.push('U+' + cp.padStart(4,'0'));
    }
    return arr;
  }

  function detectNewlines(s){
    const kinds = new Set();
    if(/\r\n/.test(s)) kinds.add('CRLF');
    const onlyCR = s.replaceAll(/\r\n/g, '').includes('\r');
    if(onlyCR) kinds.add('CR');
    if(s.replaceAll(/\r\n/g, '').includes('\n')) kinds.add('LF');
    return [...kinds].join('„ÄÅ') || '‚Äî';
  }

  // Export files
  function download(filename, content, mime){
    const blob = new Blob([content], {type: mime});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
  }
  function sanitizeFilename(s){ return s.replace(/[^\w.-]/g, '_'); }

  $('#btnExportTxt').addEventListener('click', () => {
    const ts = sanitizeFilename((lastOutput.timestamp || new Date().toISOString()).replace(/[:]/g,'-'));
    download(`clipboard-raw-${ts}.txt`, lastOutput.text, 'text/plain;charset=utf-8');
  });
  $('#btnExportEscaped').addEventListener('click', () => {
    const ts = sanitizeFilename((lastOutput.timestamp || new Date().toISOString()).replace(/[:]/g,'-'));
    download(`clipboard-escaped-${ts}.txt`, lastOutput.escaped + "\n", 'text/plain;charset=utf-8');
  });
  $('#btnExportJson').addEventListener('click', () => {
    const ts = sanitizeFilename((lastOutput.timestamp || new Date().toISOString()).replace(/[:]/g,'-'));
    const report = {
      meta: { generatedAt: lastOutput.timestamp || new Date().toISOString(), userAgent: lastOutput.ua },
      detected: lastOutput.detected,
      length: lastOutput.length,
      lines: lastOutput.lines,
      codePointsPreview: lastOutput.codePoints,
      text: lastOutput.text,
      escaped: lastOutput.escaped
    };
    download(`clipboard-report-${ts}.json`, JSON.stringify(report, null, 2), 'application/json;charset=utf-8');
  });

  // Initial output is empty.
  renderOutput('');
})();
</script>
</body>
</html>
